import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useEffect, useMemo, useState, useRef } from "react";
import { useObsidianPluginContext } from "../../Context/ObsidianPluginContext";
import Icon from "../Icon/Icon";
const Search = () => {
    const { settingsObservable, plugin } = useObsidianPluginContext();
    const [settings, setSettings] = useState(settingsObservable === null || settingsObservable === void 0 ? void 0 : settingsObservable.getValue());
    const [query, setQuery] = useState("");
    const [selectedResultIndex, setSelectedResultIndex] = useState(0);
    const resultsDiv = useRef(null);
    const searchResult = useMemo(() => query.trim().length === 0
        ? []
        : settings.myMusicIndex
            .filter((song) => (song.title &&
            song.title
                .toLowerCase()
                .indexOf(query.toLowerCase()) > -1) ||
            (song.artist &&
                song.artist
                    .toLowerCase()
                    .indexOf(query.toLowerCase()) > -1) ||
            (song.album &&
                song.album
                    .toLowerCase()
                    .indexOf(query.toLowerCase()) > -1) ||
            song.fileName
                .toLowerCase()
                .indexOf(query.toLowerCase()) > -1)
            .slice(0, 20), [settings.myMusicIndex, query]);
    /**
     * When query changes, reset selected index to 0
     */
    useEffect(() => {
        setSelectedResultIndex(0);
    }, [query, setSelectedResultIndex]);
    /**
     * Subscribe to settings from Obsidian
     */
    useEffect(() => {
        const unsubscribe = settingsObservable === null || settingsObservable === void 0 ? void 0 : settingsObservable.onChange((newSettings) => {
            setSettings(newSettings);
        });
        return () => {
            unsubscribe === null || unsubscribe === void 0 ? void 0 : unsubscribe();
        };
    }, [setSettings]);
    return (_jsxs("div", { className: "soundscapesmymusic-right-search", children: [_jsx(Icon, { name: "search" }), _jsx("input", { type: "text", className: "soundscapesmymusic-right-search-input", placeholder: "Search", value: query, onChange: (e) => setQuery(e.target.value), onFocus: (e) => {
                    e.target.addClass("soundscapesmymusic-right-search--active");
                }, onBlur: (e) => {
                    // Need to delay this so the click event can be picked up first
                    setTimeout(() => e.target.removeClass("soundscapesmymusic-right-search--active"), 100);
                }, onKeyUp: (e) => {
                    var _a, _b, _c;
                    if (searchResult.length > 0) {
                        switch (e.key) {
                            case "ArrowUp":
                                if (selectedResultIndex > 0) {
                                    setSelectedResultIndex(selectedResultIndex - 1);
                                    if (selectedResultIndex + 1 > 5) {
                                        (_a = resultsDiv === null || resultsDiv === void 0 ? void 0 : resultsDiv.current) === null || _a === void 0 ? void 0 : _a.scrollTo({
                                            top: (selectedResultIndex + 1 - 5) *
                                                60,
                                        });
                                    }
                                    else {
                                        (_b = resultsDiv === null || resultsDiv === void 0 ? void 0 : resultsDiv.current) === null || _b === void 0 ? void 0 : _b.scrollTo({
                                            top: 0,
                                        });
                                    }
                                }
                                break;
                            case "ArrowDown":
                                if (selectedResultIndex <
                                    searchResult.length - 1) {
                                    setSelectedResultIndex(selectedResultIndex + 1);
                                    // If we're beyond 6 results (index 5), move the scrollbar. Each element is around 60px;
                                    if (selectedResultIndex + 1 > 5) {
                                        (_c = resultsDiv === null || resultsDiv === void 0 ? void 0 : resultsDiv.current) === null || _c === void 0 ? void 0 : _c.scrollTo({
                                            // We're doing - 5 here because we want to align with the element that would be at the top
                                            // if the selected element is at the bottom of the view.
                                            top: (selectedResultIndex + 1 - 5) *
                                                60,
                                        });
                                    }
                                }
                                break;
                            case "Enter":
                                plugin === null || plugin === void 0 ? void 0 : plugin.changeMyMusicTrack(searchResult[selectedResultIndex].fileName);
                                break;
                        }
                    }
                } }), _jsxs("div", { className: "soundscapesmymusic-right-search-results", ref: resultsDiv, children: [query.trim() !== "" && searchResult.length === 0 && (_jsx("div", { className: "soundscapesmymusic-right-search-results-message", children: "No results found" })), query.trim() === "" && (_jsx("div", { className: "soundscapesmymusic-right-search-results-message", children: "Start typing for results..." })), searchResult.map((song, index) => (_jsxs("div", { className: `soundscapesmymusic-right-search-results-result ${selectedResultIndex === index &&
                            "soundscapesmymusic-right-search-results-result--selected"}`, onClick: () => plugin === null || plugin === void 0 ? void 0 : plugin.changeMyMusicTrack(song.fileName), children: [_jsx("div", { className: "soundscapesmymusic-right-search-results-result-line1", children: song.title }), _jsx("div", { className: "soundscapesmymusic-right-search-results-result-line2", children: song.artist })] }, song.fileName)))] })] }));
};
export default Search;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2VhcmNoLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiU2VhcmNoLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBYyxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxNQUFNLE9BQU8sQ0FBQztBQUNwRSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUMvRSxPQUFPLElBQUksTUFBTSxjQUFjLENBQUM7QUFHaEMsTUFBTSxNQUFNLEdBQUcsR0FBRyxFQUFFO0lBQ25CLE1BQU0sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLEVBQUUsR0FBRyx3QkFBd0IsRUFBRSxDQUFDO0lBQ2xFLE1BQU0sQ0FBQyxRQUFRLEVBQUUsV0FBVyxDQUFDLEdBQUcsUUFBUSxDQUN2QyxrQkFBa0IsYUFBbEIsa0JBQWtCLHVCQUFsQixrQkFBa0IsQ0FBRSxRQUFRLEVBQUUsQ0FDOUIsQ0FBQztJQUNGLE1BQU0sQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLEdBQUcsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZDLE1BQU0sQ0FBQyxtQkFBbUIsRUFBRSxzQkFBc0IsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNsRSxNQUFNLFVBQVUsR0FBRyxNQUFNLENBQWlCLElBQUksQ0FBQyxDQUFDO0lBRWhELE1BQU0sWUFBWSxHQUFHLE9BQU8sQ0FDM0IsR0FBRyxFQUFFLENBQ0osS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDLE1BQU0sS0FBSyxDQUFDO1FBQ3hCLENBQUMsQ0FBQyxFQUFFO1FBQ0osQ0FBQyxDQUFDLFFBQVEsQ0FBQyxZQUFZO2FBQ3BCLE1BQU0sQ0FDTixDQUFDLElBQUksRUFBRSxFQUFFLENBQ1IsQ0FBQyxJQUFJLENBQUMsS0FBSztZQUNWLElBQUksQ0FBQyxLQUFLO2lCQUNSLFdBQVcsRUFBRTtpQkFDYixPQUFPLENBQUMsS0FBSyxDQUFDLFdBQVcsRUFBRSxD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QUksQ0FDdkIsY0FBSyxTQUFTLEVBQUMsaURBQWlELDRDQUUxRCxDQUNOLEVBQ0EsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQ2xDLGVBRUMsU0FBUyxFQUFFLGtEQUNWLG1CQUFtQixLQUFLLEtBQUs7NEJBQzdCLDBEQUNELEVBQUUsRUFDRixPQUFPLEVBQUUsR0FBRyxFQUFFLENBQ2IsTUFBTSxhQUFOLE1BQU0sdUJBQU4sTUFBTSxDQUFFLGtCQUFrQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsYUFHMUMsY0FBSyxTQUFTLEVBQUMsc0RBQXNELFlBQ25FLElBQUksQ0FBQyxLQUFLLEdBQ04sRUFDTixjQUFLLFNBQVMsRUFBQyxzREFBc0QsWUFDbkUsSUFBSSxDQUFDLE1BQU0sR0FDUCxLQWRELElBQUksQ0FBQyxRQUFRLENBZWIsQ0FDTixDQUFDLElBQ0csSUFDRCxDQUNOLENBQUM7QUFDSCxDQUFDLENBQUM7QUFFRixlQUFlLE1BQU0sQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyB1c2VFZmZlY3QsIHVzZU1lbW8sIHVzZVN0YXRlLCB1c2VSZWYgfSBmcm9tIFwicmVhY3RcIjtcclxuaW1wb3J0IHsgdXNlT2JzaWRpYW5QbHVnaW5Db250ZXh0IH0gZnJvbSBcIi4uLy4uL0NvbnRleHQvT2JzaWRpYW5QbHVnaW5Db250ZXh0XCI7XHJcbmltcG9ydCBJY29uIGZyb20gXCIuLi9JY29uL0ljb25cIjtcclxuaW1wb3J0IHsgU291bmRzY2FwZXNQbHVnaW5TZXR0aW5ncyB9IGZyb20gXCJzcmMvU2V0dGluZ3MvU2V0dGluZ3NcIjtcclxuXHJcbmNvbnN0IFNlYXJjaCA9ICgpID0+IHtcclxuXHRjb25zdCB7IHNldHRpbmdzT2JzZXJ2YWJsZSwgcGx1Z2luIH0gPSB1c2VPYnNpZGlhblBsdWdpbkNvbnRleHQoKTtcclxuXHRjb25zdCBbc2V0dGluZ3MsIHNldFNldHRpbmdzXSA9IHVzZVN0YXRlPFNvdW5kc2NhcGVzUGx1Z2luU2V0dGluZ3M+KFxyXG5cdFx0c2V0dGluZ3NPYnNlcnZhYmxlPy5nZXRWYWx1ZSgpXHJcblx0KTtcclxuXHRjb25zdCBbcXVlcnksIHNldFF1ZXJ5XSA9IHVzZVN0YXRlKFwiXCIpO1xyXG5cdGNvbnN0IFtzZWxlY3RlZFJlc3VsdEluZGV4LCBzZXRTZWxlY3RlZFJlc3VsdEluZGV4XSA9IHVzZVN0YXRlKDApO1xyXG5cdGNvbnN0IHJlc3VsdHNEaXYgPSB1c2VSZWY8SFRNTERpdkVsZW1lbnQ+KG51bGwpO1xyXG5cclxuXHRjb25zdCBzZWFyY2hSZXN1bHQgPSB1c2VNZW1vKFxyXG5cdFx0KCkgPT5cclxuXHRcdFx0cXVlcnkudHJpbSgpLmxlbmd0aCA9PT0gMFxyXG5cdFx0XHRcdD8gW11cclxuXHRcdFx0XHQ6IHNldHRpbmdzLm15TXVzaWNJbmRleFxyXG5cdFx0XHRcdFx0XHQuZmlsdGVyKFxyXG5cdFx0XHRcdFx0XHRcdChzb25nKSA9PlxyXG5cdFx0XHRcdFx0XHRcdFx0KHNvbmcudGl0bGUgJiZcclxuXHRcdFx0XHRcdFx0XHRcdFx0c29uZy50aXRsZVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC50b0xvd2VyQ2FzZSgpXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0LmluZGV4T2YocXVlcnkudG9Mb3dlckNhc2UoKSkgPiAtMSkgfHxcclxuXHRcdFx0XHRcdFx0XHRcdChzb25nLmFydGlzdCAmJlxyXG5cdFx0XHRcdFx0XHRcdFx0XHRzb25nLmFydGlzdFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC50b0xvd2VyQ2FzZSgpXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0LmluZGV4T2YocXVlcnkudG9Mb3dlckNhc2UoKSkgPiAtMSkgfHxcclxuXHRcdFx0XHRcdFx0XHRcdChzb25nLmFsYnVtICYmXHJcblx0XHRcdFx0XHRcdFx0XHRcdHNvbmcuYWxidW1cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHQudG9Mb3dlckNhc2UoKVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC5pbmRleE9mKHF1ZXJ5LnRvTG93ZXJDYXNlKCkpID4gLTEpIHx8XHJcblx0XHRcdFx0XHRcdFx0XHRzb25nLmZpbGVOYW1lXHJcblx0XHRcdFx0XHRcdFx0XHRcdC50b0xvd2VyQ2FzZSgpXHJcblx0XHRcdFx0XHRcdFx0XHRcdC5pbmRleE9mKHF1ZXJ5LnRvTG93ZXJDYXNlKCkpID4gLTFcclxuXHRcdFx0XHRcdFx0KVxyXG5cdFx0XHRcdFx0XHQuc2xpY2UoMCwgMjApLFxyXG5cdFx0W3NldHRpbmdzLm15TXVzaWNJbmRleCwgcXVlcnldXHJcblx0KTtcclxuXHJcblx0LyoqXHJcblx0ICogV2hlbiBxdWVyeSBjaGFuZ2VzLCByZXNldCBzZWxlY3RlZCBpbmRleCB0byAwXHJcblx0ICovXHJcblx0dXNlRWZmZWN0KCgpID0+IHtcclxuXHRcdHNldFNlbGVjdGVkUmVzdWx0SW5kZXgoMCk7XHJcblx0fSwgW3F1ZXJ5LCBzZXRTZWxlY3RlZFJlc3VsdEluZGV4XSk7XHJcblxyXG5cdC8qKlxyXG5cdCAqIFN1YnNjcmliZSB0byBzZXR0aW5ncyBmcm9tIE9ic2lkaWFuXHJcblx0ICovXHJcblx0dXNlRWZmZWN0KCgpID0+IHtcclxuXHRcdGNvbnN0IHVuc3Vic2NyaWJlID0gc2V0dGluZ3NPYnNlcnZhYmxlPy5vbkNoYW5nZShcclxuXHRcdFx0KG5ld1NldHRpbmdzOiBTb3VuZHNjYXBlc1BsdWdpblNldHRpbmdzKSA9PiB7XHJcblx0XHRcdFx0c2V0U2V0dGluZ3MobmV3U2V0dGluZ3MpO1xyXG5cdFx0XHR9XHJcblx0XHQpO1xyXG5cclxuXHRcdHJldHVybiAoKSA9PiB7XHJcblx0XHRcdHVuc3Vic2NyaWJlPy4oKTtcclxuXHRcdH07XHJcblx0fSwgW3NldFNldHRpbmdzXSk7XHJcblxyXG5cdHJldHVybiAoXHJcblx0XHQ8ZGl2IGNsYXNzTmFtZT1cInNvdW5kc2NhcGVzbXltdXNpYy1yaWdodC1zZWFyY2hcIj5cclxuXHRcdFx0PEljb24gbmFtZT1cInNlYXJjaFwiIC8+XHJcblx0XHRcdDxpbnB1dFxyXG5cdFx0XHRcdHR5cGU9XCJ0ZXh0XCJcclxuXHRcdFx0XHRjbGFzc05hbWU9XCJzb3VuZHNjYXBlc215bXVzaWMtcmlnaHQtc2VhcmNoLWlucHV0XCJcclxuXHRcdFx0XHRwbGFjZWhvbGRlcj1cIlNlYXJjaFwiXHJcblx0XHRcdFx0dmFsdWU9e3F1ZXJ5fVxyXG5cdFx0XHRcdG9uQ2hhbmdlPXsoZSkgPT4gc2V0UXVlcnkoZS50YXJnZXQudmFsdWUpfVxyXG5cdFx0XHRcdG9uRm9jdXM9eyhlKSA9PiB7XHJcblx0XHRcdFx0XHRlLnRhcmdldC5hZGRDbGFzcyhcclxuXHRcdFx0XHRcdFx0XCJzb3VuZHNjYXBlc215bXVzaWMtcmlnaHQtc2VhcmNoLS1hY3RpdmVcIlxyXG5cdFx0XHRcdFx0KTtcclxuXHRcdFx0XHR9fVxyXG5cdFx0XHRcdG9uQmx1cj17KGUpID0+IHtcclxuXHRcdFx0XHRcdC8vIE5lZWQgdG8gZGVsYXkgdGhpcyBzbyB0aGUgY2xpY2sgZXZlbnQgY2FuIGJlIHBpY2tlZCB1cCBmaXJzdFxyXG5cdFx0XHRcdFx0c2V0VGltZW91dChcclxuXHRcdFx0XHRcdFx0KCkgPT5cclxuXHRcdFx0XHRcdFx0XHRlLnRhcmdldC5yZW1vdmVDbGFzcyhcclxuXHRcdFx0XHRcdFx0XHRcdFwic291bmRzY2FwZXNteW11c2ljLXJpZ2h0LXNlYXJjaC0tYWN0aXZlXCJcclxuXHRcdFx0XHRcdFx0XHQpLFxyXG5cdFx0XHRcdFx0XHQxMDBcclxuXHRcdFx0XHRcdCk7XHJcblx0XHRcdFx0fX1cclxuXHRcdFx0XHRvbktleVVwPXsoZSkgPT4ge1xyXG5cdFx0XHRcdFx0aWYgKHNlYXJjaFJlc3VsdC5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0XHRcdHN3aXRjaCAoZS5rZXkpIHtcclxuXHRcdFx0XHRcdFx0XHRjYXNlIFwiQXJyb3dVcFwiOlxyXG5cdFx0XHRcdFx0XHRcdFx0aWYgKHNlbGVjdGVkUmVzdWx0SW5kZXggPiAwKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdHNldFNlbGVjdGVkUmVzdWx0SW5kZXgoXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0c2VsZWN0ZWRSZXN1bHRJbmRleCAtIDFcclxuXHRcdFx0XHRcdFx0XHRcdFx0KTtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdGlmIChzZWxlY3RlZFJlc3VsdEluZGV4ICsgMSA+IDUpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRyZXN1bHRzRGl2Py5jdXJyZW50Py5zY3JvbGxUbyh7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR0b3A6XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdChzZWxlY3RlZFJlc3VsdEluZGV4ICsgMSAtIDUpICpcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0NjAsXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0cmVzdWx0c0Rpdj8uY3VycmVudD8uc2Nyb2xsVG8oe1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0dG9wOiAwLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRcdFx0XHRjYXNlIFwiQXJyb3dEb3duXCI6XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoXHJcblx0XHRcdFx0XHRcdFx0XHRcdHNlbGVjdGVkUmVzdWx0SW5kZXggPFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRzZWFyY2hSZXN1bHQubGVuZ3RoIC0gMVxyXG5cdFx0XHRcdFx0XHRcdFx0KSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdHNldFNlbGVjdGVkUmVzdWx0SW5kZXgoXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0c2VsZWN0ZWRSZXN1bHRJbmRleCArIDFcclxuXHRcdFx0XHRcdFx0XHRcdFx0KTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gSWYgd2UncmUgYmV5b25kIDYgcmVzdWx0cyAoaW5kZXggNSksIG1vdmUgdGhlIHNjcm9sbGJhci4gRWFjaCBlbGVtZW50IGlzIGFyb3VuZCA2MHB4O1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoc2VsZWN0ZWRSZXN1bHRJbmRleCArIDEgPiA1KSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0cmVzdWx0c0Rpdj8uY3VycmVudD8uc2Nyb2xsVG8oe1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0Ly8gV2UncmUgZG9pbmcgLSA1IGhlcmUgYmVjYXVzZSB3ZSB3YW50IHRvIGFsaWduIHdpdGggdGhlIGVsZW1lbnQgdGhhdCB3b3VsZCBiZSBhdCB0aGUgdG9wXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQvLyBpZiB0aGUgc2VsZWN0ZWQgZWxlbWVudCBpcyBhdCB0aGUgYm90dG9tIG9mIHRoZSB2aWV3LlxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0dG9wOlxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHQoc2VsZWN0ZWRSZXN1bHRJbmRleCArIDEgLSA1KSAqXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdDYwLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRcdFx0XHRjYXNlIFwiRW50ZXJcIjpcclxuXHRcdFx0XHRcdFx0XHRcdHBsdWdpbj8uY2hhbmdlTXlNdXNpY1RyYWNrKFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRzZWFyY2hSZXN1bHRbc2VsZWN0ZWRSZXN1bHRJbmRleF0uZmlsZU5hbWVcclxuXHRcdFx0XHRcdFx0XHRcdCk7XHJcblx0XHRcdFx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH19XHJcblx0XHRcdC8+XHJcblx0XHRcdDxkaXZcclxuXHRcdFx0XHRjbGFzc05hbWU9XCJzb3VuZHNjYXBlc215bXVzaWMtcmlnaHQtc2VhcmNoLXJlc3VsdHNcIlxyXG5cdFx0XHRcdHJlZj17cmVzdWx0c0Rpdn1cclxuXHRcdFx0PlxyXG5cdFx0XHRcdHtxdWVyeS50cmltKCkgIT09IFwiXCIgJiYgc2VhcmNoUmVzdWx0Lmxlbmd0aCA9PT0gMCAmJiAoXHJcblx0XHRcdFx0XHQ8ZGl2IGNsYXNzTmFtZT1cInNvdW5kc2NhcGVzbXltdXNpYy1yaWdodC1zZWFyY2gtcmVzdWx0cy1tZXNzYWdlXCI+XHJcblx0XHRcdFx0XHRcdE5vIHJlc3VsdHMgZm91bmRcclxuXHRcdFx0XHRcdDwvZGl2PlxyXG5cdFx0XHRcdCl9XHJcblx0XHRcdFx0e3F1ZXJ5LnRyaW0oKSA9PT0gXCJcIiAmJiAoXHJcblx0XHRcdFx0XHQ8ZGl2IGNsYXNzTmFtZT1cInNvdW5kc2NhcGVzbXltdXNpYy1yaWdodC1zZWFyY2gtcmVzdWx0cy1tZXNzYWdlXCI+XHJcblx0XHRcdFx0XHRcdFN0YXJ0IHR5cGluZyBmb3IgcmVzdWx0cy4uLlxyXG5cdFx0XHRcdFx0PC9kaXY+XHJcblx0XHRcdFx0KX1cclxuXHRcdFx0XHR7c2VhcmNoUmVzdWx0Lm1hcCgoc29uZywgaW5kZXgpID0+IChcclxuXHRcdFx0XHRcdDxkaXZcclxuXHRcdFx0XHRcdFx0a2V5PXtzb25nLmZpbGVOYW1lfVxyXG5cdFx0XHRcdFx0XHRjbGFzc05hbWU9e2Bzb3VuZHNjYXBlc215bXVzaWMtcmlnaHQtc2VhcmNoLXJlc3VsdHMtcmVzdWx0ICR7XHJcblx0XHRcdFx0XHRcdFx0c2VsZWN0ZWRSZXN1bHRJbmRleCA9PT0gaW5kZXggJiZcclxuXHRcdFx0XHRcdFx0XHRcInNvdW5kc2NhcGVzbXltdXNpYy1yaWdodC1zZWFyY2gtcmVzdWx0cy1yZXN1bHQtLXNlbGVjdGVkXCJcclxuXHRcdFx0XHRcdFx0fWB9XHJcblx0XHRcdFx0XHRcdG9uQ2xpY2s9eygpID0+XHJcblx0XHRcdFx0XHRcdFx0cGx1Z2luPy5jaGFuZ2VNeU11c2ljVHJhY2soc29uZy5maWxlTmFtZSlcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0PlxyXG5cdFx0XHRcdFx0XHQ8ZGl2IGNsYXNzTmFtZT1cInNvdW5kc2NhcGVzbXltdXNpYy1yaWdodC1zZWFyY2gtcmVzdWx0cy1yZXN1bHQtbGluZTFcIj5cclxuXHRcdFx0XHRcdFx0XHR7c29uZy50aXRsZX1cclxuXHRcdFx0XHRcdFx0PC9kaXY+XHJcblx0XHRcdFx0XHRcdDxkaXYgY2xhc3NOYW1lPVwic291bmRzY2FwZXNteW11c2ljLXJpZ2h0LXNlYXJjaC1yZXN1bHRzLXJlc3VsdC1saW5lMlwiPlxyXG5cdFx0XHRcdFx0XHRcdHtzb25nLmFydGlzdH1cclxuXHRcdFx0XHRcdFx0PC9kaXY+XHJcblx0XHRcdFx0XHQ8L2Rpdj5cclxuXHRcdFx0XHQpKX1cclxuXHRcdFx0PC9kaXY+XHJcblx0XHQ8L2Rpdj5cclxuXHQpO1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgU2VhcmNoO1xyXG4iXX0=